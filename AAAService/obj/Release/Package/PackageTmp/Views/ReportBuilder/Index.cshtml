@*@model Tuple<AAAService.Models.ReportBuilderModel.ReportInformation, IEnumerable<AAAService.Models.ReportBuilderModel.Companies>, IEnumerable<AAAService.Models.ReportBuilderModel.Locations>, IEnumerable<AAAService.Models.ReportBuilderModel.ReportBuilderFields>>*@

@*@model Tuple<AAAService.Models.ReportBuilderModel.ReportInformation, IEnumerable<AAAService.Models.ReportBuilderModel.Companies>, IEnumerable<AAAService.Models.ReportBuilderModel.ReportBuilderFields>>*@

@model AAAService.Models.ReportBuilderModel.ReportInformation

@using GridMvc.Html

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>

@{
    ViewBag.Title = "Index";
}

<h2>Report Builder</h2>

@*@using (Html.BeginForm("GenerateExcel", "ReportBuilder", FormMethod.Post))*@
@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()    

    <div class="form-horizontal">
        <hr />
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })        

        <div class="form-group">
            @Html.LabelFor(model => model.ReportName, "Report Name", htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.ReportName, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.ReportName, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="col-xs-5">
            <select name="ddlCompanies" id="ddlCompanies" class="form-control" size="10" onchange="javascript:GetServiceLocations(this.value);">
                @foreach (var company in Model.Companies)
                {
                    <option value="@company.GUID">@company.Name</option>
                }
            </select>
        </div>

        <div class="col-xs-2">
        </div>

        <div class="col-xs-5">
            <select name="ddlLocations" id="ddlLocations" class="form-control" size="10" multiple="multiple">
                    <option value="">Choose a Company</option>
            </select>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.From, htmlAttributes: new { @class = "control-label col-md-2" })

            <div class="col-md-10">
                @Html.EditorFor(model => model.From, new { htmlAttributes = new { id = "Item1_From", @class = "form-control", @onclick = "javascript:SetStatus(1);" }
           })

                @Html.ValidationMessageFor(model => model.From, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.To, htmlAttributes: new { @class = "control-label col-md-2" })

            <div class="col-md-10">
                @Html.EditorFor(model => model.To, new { htmlAttributes = new { id = "Item1_To", @class = "form-control", @onclick = "javascript:SetStatus(1);" }
           })

                @Html.ValidationMessageFor(model => model.To, "", new { @class = "text-danger" })
            </div>
        </div>

        <h4>Please Choose Which Fields You'd Like</h4>

        <div class="col-xs-5">
            <select name="from[]" id="search" class="form-control" size="10" multiple="multiple">
                @foreach (var reportBuilderFields in Model.ReportBuilderFields)
                {
                    <option value="@reportBuilderFields.ColumnName">@reportBuilderFields.Name</option>
                }
            </select>
        </div>

        <div class="col-xs-2">
            <br />
            <button type="button" id="search_rightAll" class="btn btn-block"><i class="glyphicon glyphicon-forward"></i></button>
            <button type="button" id="search_rightSelected" class="btn btn-block"><i class="glyphicon glyphicon-chevron-right"></i></button>
            <button type="button" id="search_leftSelected" class="btn btn-block"><i class="glyphicon glyphicon-chevron-left"></i></button>
            <button type="button" id="search_leftAll" class="btn btn-block"><i class="glyphicon glyphicon-backward"></i></button>
        </div>

        <div class="col-xs-5">
            <select name="to[]" id="search_to" class="form-control" size="10" multiple="multiple">
            </select>
        </div>

        <div class="form-group">
            <div class="col-md-offset-2 col-md-10">
                <input type="submit" value="Run Report" class="btn btn-success" />
            </div>
        </div>
    </div>    
}

@*@Html.ActionLink("Export to Excel", "GenerateExcelSpreadsheet")*@

@*<div style="width:auto">*@
    @*@Html.Grid(Model.ReportBuilderView).Columns(columns =>
    {
        columns.Add(column => column.company_name)
               .Filterable(true);
    }).WithPaging(50).Sortable(true)*@
@*</div>*@

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
@*<script type="text/javascript" src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script> Causing problems with Menu in Layout and once Report Buidler is selected, we cannot move to other menu option unless we go to Home*@
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.js"></script>
<script type="text/javascript" src="/Scripts/multiselect.min.js"></script>

@section scripts {
    <script type="text/javascript">
        $(function () {
            $('#Item1_From').datetimepicker({
                defaultDate: '@Model.From',
                showClose: true,
                showClear: true,
                toolbarPlacement: 'top'
            });

            $('#Item1_To').datetimepicker({
                defaultDate: '@Model.To',
                showClose: true,
                showClear: true,
                toolbarPlacement: 'top',
            });
        });
    </script>
}

<script type="text/javascript">
    function GetServiceLocations(_companyGUID) {
        var procemessage = "<option value='0'> Please wait...</option>";
        $("#ddlLocations").html(procemessage).show();
        var url = "/ReportBuilder/GetServiceLocations/";

        $.ajax({
            url: url,
            data: { companyGUID: _companyGUID },
            cache: false,
            type: "POST",
            success: function (data) {
                var markup = "";

                for (var x = 0; x < data.length; x++) {
                    markup += "<option value=" + data[x].Value + ">" + data[x].Text + "</option>";
                }

                $("#ddlLocations").html(markup).show();
            },
            error: function (reponse) {
                alert("error : " + reponse);
            }
        });
    }

    jQuery(document).ready(function ($) {
        $('#search').multiselect({
            keepRenderingSort: true,
            search: {
                left: '<input type="text" name="q" class="form-control" placeholder="Search..." />',
                right: '<input type="text" name="q" class="form-control" placeholder="Search..." />',
            }
        });
    });

    function SetStatus(_statusID) {
        $("#StatusID").val(_statusID);
    }
</script>